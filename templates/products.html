{% extends "layout.html" %}
{% block title %}Products{% endblock %}
{% block head %}
{{ super() }}

{% endblock %}
{% block content %}
<div class="container" id="app">
  <div class="mt-4" id="myform" action="/" method="POST">
    <div class="myform" @submit.prevent="submitForm">
      <form class="mt-4">
        <div class="mb-3">
          <label for="name" class="form-label">Product name</label>
          <input type="text" name="product_name" id="product_name" class="form-control" required
            v-model="new_data.name">
        </div>
        <div class="mb-3">
          <label for="buying_price" class="form-label">product price</label>
          <input type="text" name="buying_price" id="buying_price" class="form-control" required
            v-model="new_data.price">
        </div>
        <button type="submit" class="btn btn-success">Add Product</button>
    </div>
  </div>


  <div class="mytable">
    <table class="table" v-if="prods.length > 0">

      <thead>
        <tr>
          <th>Product name</th>
          <th>Price</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="prod in prods" :key="prod.id">
          <td> {{ prod.id }}</td>
          <td> {{ prod.price }}</td>
          <td> {{ prod.name }}</td>
          
        </tr>
      </tbody>


    </table>
  </div>
</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
  Vue.createApp({
    data() {

      let new_data = {
        name: "",
        price: 0
      };
      let prods = [];

      return { new_data, prods }
    },
    methods: {
      submitForm() {

        console.log('Form submitted:', this.new_data);
        axios.post("http://127.0.0.1:5000/products", this.new_data)
          .then(Response => {
            console.log("result: ", Response)
            this.prods.push(response.data);
            this.loading = false;
          })
          .catch(error => {
            console.log(error);
          })
      },
      fetchproducts() {
        axios.get('http://127.0.0.1:5000/products')
          .then(response => {
            console.log("response from api ", response);
            this.prods = response.data;
            this.loading = false;
          })
          .catch(error => {
            console.error('Error fetching data:', error);
            this.loading = false;
          });

      },
      

    },
    created() {
      this.submitForm(),
      this.fetchproducts()
      
    }

  }).mount('#app')

</script>

<!-- <script src="v-products.js"> </script> -->



{% endblock %}